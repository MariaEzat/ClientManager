<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 900px;
    margin: 30px auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    color: #3a6ea5;
    font-size: 28px;
    margin-bottom: 30px;
  }
  label {
    font-weight: bold;
    margin-bottom: 8px;
    display: block;
  }
  input, select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
    margin-bottom: 10px;
  }
  button {
    background-color: #3a6ea5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    transition: 0.3s;
    margin: 5px 0;
  }
  button:hover {
    background-color: #2f5c88;
  }
  .btn-Delete{
    background-color:#d9534f;
  }
  .btnDelete{
    border: none;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    text-align: center;
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-size: 15px;
  }
  th {
    background-color: #3a6ea5;
    color: white;
  }
  .summary, .total, .message {
    text-align: center;
    margin-top: 15px;
    font-size: 16px;
  }
  .message {
    background-color: #eef5ff;
    border-radius: 10px;
    padding: 10px;
    color: #2f5c88;
    font-weight: bold;
    display: none;
  }
  .payment-row {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .payment-row input {
    width: 150px;
  }
  .hidden { display: none; }
  @media (max-width: 600px) {
    .payment-row { flex-direction: column; }
    input { width: 100%; }
  }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
  <div id="clientSection">
    <label>Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„:</label>
    <select id="clientSelect" onchange="showClientDetails()">
      <option value="">-- Ø§Ø®ØªØ§Ø± Ø¹Ù…ÙŠÙ„ --</option>
    </select>

    <button onclick="showAddClient()" >â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
    <button onclick="deleteClient()" class="btn-Delete">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„</button>

    <table id="clientTable" class="hidden">
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø§Ù„Ø³Ø¹Ø±</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          <th>Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button id="addProductBtn" class="hidden" onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</button>

    <div class="summary hidden" id="summary">
      <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡</p>
      <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: <span id="totalPaid">0</span> Ø¬Ù†ÙŠÙ‡</p>
      <p>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="remaining">0</span> Ø¬Ù†ÙŠÙ‡</p>

      <div class="payment-row">
        <input type="number" id="paid" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">
        <button onclick="confirmPayment()">ØªÙ… Ø§Ù„Ø¯ÙØ¹ âœ…</button>
      </div>

      <div class="message" id="paymentMessage"></div>
      <button onclick="showReport()">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>
  </div>

  <!-- Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ -->
  <div id="addClientSection" class="hidden">
    <h1>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h1>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="newClientName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
    <input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
    <input type="number" id="productQty" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹">
    <label>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
    <input type="number" id="productPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡">
    <button onclick="addProductToNewClient()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>

    <table id="productsTable">
      <thead>
        <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="totalPrice">0</span> Ø¬Ù†ÙŠÙ‡</div>
    <button onclick="saveClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
    <button onclick="showClientSection()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
  </div>

  <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
  <div id="reportSection" class="hidden">
    <h1 id="reportClientName">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</h1>
    <table id="reportProductsTable">
      <thead>
        <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="total">
      Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="reportTotal">0</span> Ø¬Ù†ÙŠÙ‡<br>
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: <span id="reportPaid">0</span> Ø¬Ù†ÙŠÙ‡<br>
      Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="reportRemain">0</span> Ø¬Ù†ÙŠÙ‡
    </div>

    <h3 style="margin-top:20px;">ğŸ’³ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø§Øª:</h3>
    <table id="historyTable">
      <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th></tr></thead>
      <tbody></tbody>
    </table>

    <button onclick="showClientSection()">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
  </div>
</div>

<script>
let clients = JSON.parse(localStorage.getItem("clients") || "[]");
let newClientProducts = [];

// Ø£Ù‚Ø³Ø§Ù…
const clientSection = document.getElementById("clientSection");
const addClientSection = document.getElementById("addClientSection");
const reportSection = document.getElementById("reportSection");

function showClientSection(){
  clientSection.classList.remove("hidden");
  addClientSection.classList.add("hidden");
  reportSection.classList.add("hidden");
  loadClients();
  document.getElementById("clientTable").classList.add("hidden");
  document.getElementById("summary").classList.add("hidden");
  document.getElementById("addProductBtn").classList.add("hidden");
}

function showAddClient(){
  clientSection.classList.add("hidden");
  addClientSection.classList.remove("hidden");
  reportSection.classList.add("hidden");
  newClientProducts = [];
  renderNewClientTable();
}

function showReport(){
  const index = document.getElementById("clientSelect").value;
  if(index==="") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  clientSection.classList.add("hidden");
  addClientSection.classList.add("hidden");
  reportSection.classList.remove("hidden");
  const client = clients[index];
  document.getElementById("reportClientName").textContent = `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.name}`;

  const tbody = document.querySelector("#reportProductsTable tbody");
  tbody.innerHTML = "";
  client.products.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.total}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("reportTotal").textContent=client.total;
  document.getElementById("reportPaid").textContent=client.paid;
  document.getElementById("reportRemain").textContent=client.total-client.paid;

  const histBody = document.querySelector("#historyTable tbody");
  histBody.innerHTML="";
  client.history.forEach(h=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${h.date}</td><td>${h.paid}</td>`;
    histBody.appendChild(tr);
  });
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
const clientSelect=document.getElementById("clientSelect");
function loadClients(){
  clientSelect.innerHTML='<option value="">-- Ø§Ø®ØªØ§Ø± Ø¹Ù…ÙŠÙ„ --</option>';
  clients.forEach((c,i)=>{
    const opt=document.createElement("option");
    opt.value=i;
    opt.textContent=c.name;
    clientSelect.appendChild(opt);
  });
}

function showClientDetails(){
  const index=clientSelect.value;
  if(index==="") return;
  const client=clients[index];
  const tbody=document.querySelector("#clientTable tbody");
  tbody.innerHTML="";
  client.products.forEach((p,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.total}</td><td><button onclick="deleteProduct(${index},${i})" class="btnDelete">ğŸ—‘ï¸</button></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("clientTable").classList.remove("hidden");
  document.getElementById("summary").classList.remove("hidden");
  document.getElementById("addProductBtn").classList.remove("hidden");
  document.getElementById("total").textContent=client.total;
  document.getElementById("totalPaid").textContent=client.paid;
  document.getElementById("remaining").textContent=client.total-client.paid;
  document.getElementById("paid").value="";
  document.getElementById("paymentMessage").style.display="none";
}

function confirmPayment(){
  const index=clientSelect.value;
  if(index==="") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  const client=clients[index];
  const newPayment=Number(document.getElementById("paid").value);
  if(isNaN(newPayment)||newPayment<=0) return alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");
  client.paid=(client.paid||0)+newPayment;
  if(client.paid>client.total) client.paid=client.total;
  const remaining=client.total-client.paid;

  const now=new Date();
  let hours=now.getHours();
  const minutes=now.getMinutes().toString().padStart(2,'0');
  const ampm=hours>=12?'PM':'AM';
  hours=hours%12||12;
  const today=`${now.getDate().toString().padStart(2,'0')}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getFullYear()} - ${hours.toString().padStart(2,'0')}:${minutes} ${ampm}`;
  client.history=client.history||[];
  client.history.push({date:today, paid:newPayment});
  localStorage.setItem("clients", JSON.stringify(clients));

  document.getElementById("totalPaid").textContent=client.paid;
  document.getElementById("remaining").textContent=remaining;
  const msg=document.getElementById("paymentMessage");
  msg.style.display="block";
  msg.textContent=remaining===0?`âœ… ØªÙ… Ø¯ÙØ¹ ${newPayment} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø³Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ§Ù…Ù„Ù‹Ø§.`:`ğŸ’° ØªÙ… Ø¯ÙØ¹ ${newPayment} Ø¬Ù†ÙŠÙ‡ â€” Ø§Ù„Ø¨Ø§Ù‚ÙŠ ${remaining} Ø¬Ù†ÙŠÙ‡.`;
  document.getElementById("paid").value="";
  showClientDetails();
}

function addProduct(){
  const index=clientSelect.value;
  if(index==="") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");
  const name=prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:");
  if(!name) return;
  const qty=Number(prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©:"));
  if(isNaN(qty)||qty<=0) return alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
  const price=Number(prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±:"));
  if(isNaN(price)||price<=0) return alert("Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± ØµØ­ÙŠØ­");
  const total=qty*price;
  clients[index].products.push({name, qty, price, total});
  clients[index].total+=total;
  localStorage.setItem("clients", JSON.stringify(clients));
  showClientDetails();
}

function deleteClient(){
  const index=clientSelect.value;
  if(index==="") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ù„Ø­Ø°ÙÙ‡");
  if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ${clients[index].name}ØŸ`)){
    clients.splice(index,1);
    localStorage.setItem("clients", JSON.stringify(clients));
    loadClients();
    document.getElementById("clientTable").classList.add("hidden");
    document.getElementById("summary").classList.add("hidden");
    document.getElementById("addProductBtn").classList.add("hidden");
    alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
  }
}

function deleteProduct(clientIndex, productIndex){
  if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
    clients[clientIndex].total -= clients[clientIndex].products[productIndex].total;
    clients[clientIndex].products.splice(productIndex,1);
    localStorage.setItem("clients", JSON.stringify(clients));
    showClientDetails();
  }
}

// Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
function addProductToNewClient(){
  const name=document.getElementById("productName").value.trim();
  const qty=Number(document.getElementById("productQty").value);
  const price=Number(document.getElementById("productPrice").value);
  if(!name||qty<=0||price<=0) return alert("Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© Ù„Ù„Ù…Ù†ØªØ¬");
  newClientProducts.push({name, qty, price, total: qty*price});
  renderNewClientTable();
  document.getElementById("productName").value="";
  document.getElementById("productQty").value="";
  document.getElementById("productPrice").value="";
}

function renderNewClientTable(){
  const tbody=document.querySelector("#productsTable tbody");
  tbody.innerHTML="";
  let totalPrice=0;
  newClientProducts.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.qty}</td><td>${p.price}</td><td>${p.total}</td>`;
    tbody.appendChild(tr);
    totalPrice+=p.total;
  });
  document.getElementById("totalPrice").textContent=totalPrice;
}

function saveClient(){
  const name=document.getElementById("newClientName").value.trim();
  if(!name) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„");
  if(newClientProducts.length===0) return alert("Ø£Ø¶Ù Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  const total=newClientProducts.reduce((sum,p)=>sum+p.total,0);
  const client={name, products:newClientProducts, total, paid:0, history:[]};
  clients.push(client);
  localStorage.setItem("clients", JSON.stringify(clients));
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
  showClientSection();
}

showClientSection();
</script>
</body>
</html>
