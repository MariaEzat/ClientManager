<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background-color: #f5f7fa;
    margin: 0;
    padding: 0;
  }
  .container {
    max-width: 900px;
    margin: 30px auto;
    background: white;
    padding: 30px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  h1 {
    text-align: center;
    color: #3a6ea5;
    font-size: 28px;
    margin-bottom: 30px;
  }
  .client-label {
    font-weight: bold;
    margin-bottom: 8px;
    display: block;
  }
  .client-row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .deleteSelectedBtn{
    border: none;
  }
  .client-row select {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
  }
  .addClient {
    background-color: #3a6ea5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
    white-space: nowrap;
  }
  .addClient:hover {
    background-color: #2f5c88;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    text-align: center;
    padding: 10px;
    border-bottom: 1px solid #eee;
    font-size: 15px;
  }
  th {
    background-color: #3a6ea5;
    color: white;
  }
  .summary {
    text-align: center;
    font-size: 18px;
    color: #333;
    background-color: #f9fbfd;
    border-radius: 10px;
    padding: 15px;
    margin-top: 15px;
  }
  .message {
    background-color: #eef5ff;
    border-radius: 10px;
    padding: 10px;
    margin-top: 10px;
    text-align: center;
    color: #2f5c88;
    font-weight: bold;
  }
  .add-product-btn {
    background-color: #3a6ea5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
    margin-top: 10px;
  }
  .add-product-btn:hover {
    background-color: #2f5c88;
    transform: translateY(-1px);
  }
  .payment-row {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
    margin-top: 15px;
    flex-wrap: wrap;
  }
  .payment-row label {
    font-weight: bold;
    white-space: nowrap;
  }
  .payment-row input {
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 150px;
    text-align: center;
  }
  .pay-btn {
    background-color: #3a6ea5;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .pay-btn:hover {
    background-color: #2f5c88;
    transform: translateY(-1px);
  }
  .delete-btn {
    background-color: #d9534f;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    transition: 0.3s;
  }
  .delete-btn:hover {
    background-color: #c9302c;
  }
/* Ù„Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØµØºÙŠØ±Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª */
@media (max-width: 600px) {
  .client-row select {
    width: 100%;
  }
  .client-buttons {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }
  .client-buttons button {
    flex: 1;
  }
}

</style>
</head>
<body>

<div class="container">
  <h1>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>

  <label class="client-label">Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„:</label>
 <div class="client-row">
  <select id="clientSelect" onchange="showClientDetails()">
    <option value="">-- Ø§Ø®ØªØ§Ø± Ø¹Ù…ÙŠÙ„ --</option>
  </select>
</div>
<div class="client-buttons">
  <button onclick="window.location.href='add-Client.html'" class="addClient">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
  <button onclick="deleteClient()" class="delete-btn">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
</div>


  <table id="clientTable" style="display:none;">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th>Ø­Ø°Ù</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top: 15px; display:none;" id="addProductDiv">
    <button class="add-product-btn" onclick="addProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
  </div>

  <div class="summary" id="summary" style="display:none;">
    <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: <span id="total">0</span> Ø¬Ù†ÙŠÙ‡</p>
    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹: <span id="totalPaid">0</span> Ø¬Ù†ÙŠÙ‡</p>
    <p>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="remaining">0</span> Ø¬Ù†ÙŠÙ‡</p>
    
    <div class="payment-row">
      <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</label>
      <input type="number" id="paid" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">
      <button onclick="confirmPayment()" class="pay-btn">ØªÙ… Ø§Ù„Ø¯ÙØ¹ âœ…</button>
    </div>

    <div class="message" id="paymentMessage" style="display:none;"></div>
  </div>

  <div style="text-align:center; margin-top:25px;">
    <button 
      onclick="
        if(!clientSelect.value) {
          alert('â— ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        } else {
          localStorage.setItem('reportClientIndex', clientSelect.value);
          window.location.href='report.html';
        }
      "
      style="
        background: linear-gradient(90deg, #3a6ea5, #2f5c88);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      "
      onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';"
      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
    >
      ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    </button>
  </div>

</div>

<script>
  const clientSelect = document.getElementById("clientSelect");
  let clients = JSON.parse(localStorage.getItem("clients") || "[]");

  function loadClients(list = clients) {
    clientSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ§Ø± Ø¹Ù…ÙŠÙ„ --</option>';
    list.forEach((c, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.textContent = c.name;
      clientSelect.appendChild(opt);
    });
  }

  loadClients();

  function showClientDetails() {
    const index = clientSelect.value;
    if(index === "") return;

    const client = clients[index];
    const tbody = document.querySelector("#clientTable tbody");
    tbody.innerHTML = "";

    client.products.forEach((p, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${p.name}</td>
        <td>${p.qty}</td>
        <td>${p.price}</td>
        <td>${p.total}</td>
        <td><button class="deleteSelectedBtn" onclick="deleteProduct(${index}, ${i})">ğŸ—‘ï¸</button></td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("clientTable").style.display = "table";
    document.getElementById("summary").style.display = "block";
    document.getElementById("addProductDiv").style.display = "block";
    document.getElementById("total").textContent = client.total;
    document.getElementById("totalPaid").textContent = client.paid || 0;
    document.getElementById("remaining").textContent = client.total - (client.paid || 0);
    document.getElementById("paid").value = "";
    document.getElementById("paymentMessage").style.display = "none";
  }

  function confirmPayment() {
    const index = clientSelect.value;
    if(index === "") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");

    const client = clients[index];
    const paidInput = document.getElementById("paid");
    const paymentMessage = document.getElementById("paymentMessage");
    const newPayment = Number(paidInput.value);
    if(isNaN(newPayment) || newPayment <= 0) return alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");

    if(!client.paid) client.paid = 0;
    client.paid += newPayment;
    if(client.paid > client.total) client.paid = client.total;

    const remaining = client.total - client.paid;

    const now = new Date();
    let hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2,'0');
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12;
    const today = `${now.getDate().toString().padStart(2,'0')}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getFullYear()} - ${hours.toString().padStart(2,'0')}:${minutes} ${ampm}`;

    if(!client.history) client.history = [];
    client.history.push({ date: today, paid: newPayment });
    localStorage.setItem("clients", JSON.stringify(clients));

    document.getElementById("totalPaid").textContent = client.paid;
    document.getElementById("remaining").textContent = remaining;

    paymentMessage.style.display = "block";
    paymentMessage.textContent = remaining === 0 
      ? `âœ… ØªÙ… Ø¯ÙØ¹ ${newPayment} Ø¬Ù†ÙŠÙ‡ØŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø³Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ§Ù…Ù„Ù‹Ø§.` 
      : `ğŸ’° ØªÙ… Ø¯ÙØ¹ ${newPayment} Ø¬Ù†ÙŠÙ‡ â€” Ø§Ù„Ø¨Ø§Ù‚ÙŠ ${remaining} Ø¬Ù†ÙŠÙ‡.`;

    paidInput.value = "";
    showClientDetails();
  }

  function addProduct() {
    const index = clientSelect.value;
    if(index === "") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹");

    const client = clients[index];
    const name = prompt("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:");
    if(!name) return;

    const qty = Number(prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©:"));
    if(isNaN(qty) || qty <= 0) return alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");

    const price = Number(prompt("Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬:"));
    if(isNaN(price) || price <= 0) return alert("Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± ØµØ­ÙŠØ­");

    const total = qty * price;
    client.products.push({ name, qty, price, total });
    client.total += total;

    localStorage.setItem("clients", JSON.stringify(clients));
    showClientDetails();
  }

  function deleteClient() {
    const index = clientSelect.value;
    if(index === "") return alert("â— Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ Ù„Ø­Ø°ÙÙ‡");
    if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ${clients[index].name}ØŸ`)) {
      clients.splice(index, 1);
      localStorage.setItem("clients", JSON.stringify(clients));
      loadClients();
      document.getElementById("clientTable").style.display = "none";
      document.getElementById("summary").style.display = "none";
      document.getElementById("addProductDiv").style.display = "none";
      alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
    }
  }

  function deleteProduct(clientIndex, productIndex) {
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
      clients[clientIndex].total -= clients[clientIndex].products[productIndex].total;
      clients[clientIndex].products.splice(productIndex, 1);
      localStorage.setItem("clients", JSON.stringify(clients));
      showClientDetails();
    }
  }
</script>
</body>
</html>
